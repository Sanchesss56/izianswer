<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—Ç—Ä–∞–¥–∞—é—â–µ–µ –°—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤—å–µ</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5e6c8;
            color: #49281A;
        }
        
        h1, h2, h3 {
            text-align: center;
            color: #771c1c;
        }
        
        .game-container {
            display: none;
            border: 2px solid #771c1c;
            border-radius: 5px;
            padding: 20px;
            margin-top: 20px;
            background-color: #f9f1e0;
        }
        
        .lobby {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .player-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .player-card {
            border: 1px solid #771c1c;
            background-color: #f9f1e0;
            padding: 10px;
            width: 200px;
            border-radius: 5px;
            box-shadow: 3px 3px 5px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .player-card.active {
            border: 3px solid #00a300;
        }
        
        .player-card.current-player {
            background-color: #ffe0b3;
        }
        
        .resource {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }
        
        .action-area {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        
        button {
            background-color: #771c1c;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
        }
        
        button:hover {
            background-color: #550c0c;
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .log-area {
            height: 150px;
            overflow-y: auto;
            border: 1px solid #771c1c;
            padding: 10px;
            margin-top: 20px;
            background-color: #fff;
            font-size: 14px;
        }

        .event-display {
            background-color: #ffe0b3;
            padding: 10px;
            border: 1px solid #771c1c;
            margin: 10px 0;
            text-align: center;
        }
        
        .resources-area, .buildings-area, .event-area {
            margin-top: 20px;
            border: 1px solid #771c1c;
            padding: 10px;
            background-color: #fff;
        }
        
        .building {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            padding: 5px;
            background-color: #f0f0f0;
            border-radius: 3px;
        }
        
        #game-code-display {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
            color: #771c1c;
        }
        
        .tab {
            display: inline-block;
            padding: 10px 20px;
            cursor: pointer;
            background-color: #c9a987;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
        }
        
        .tab.active {
            background-color: #771c1c;
            color: white;
        }
        
        .tab-content {
            display: none;
            padding: 15px;
            border: 1px solid #771c1c;
            background-color: #f9f1e0;
        }
        
        .tab-content.active {
            display: block;
        }

        .deaths-counter {
            font-size: 24px;
            color: #771c1c;
            text-align: center;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>–°—Ç—Ä–∞–¥–∞—é—â–µ–µ –°—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤—å–µ</h1>
    <p class="deaths-counter">–°–º–µ—Ä—Ç–µ–π –∑–∞ –∏–≥—Ä—É: <span id="death-counter">0</span></p>
    
    <div id="login-container">
        <h2>–í–æ–π—Ç–∏ –≤ –∏–≥—Ä—É</h2>
        <div style="text-align: center;">
            <input type="text" id="player-name" placeholder="–í–∞—à–µ –∏–º—è" maxlength="15" style="padding: 5px; margin-right: 10px;">
            <button id="create-game-btn">–°–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É</button>
            <div style="margin-top: 20px;">
                <input type="text" id="game-code-input" placeholder="–ö–æ–¥ –∏–≥—Ä—ã" style="padding: 5px; margin-right: 10px;">
                <button id="join-game-btn">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
            </div>
        </div>
    </div>
    
    <div id="lobby-container" class="game-container">
        <h2>–õ–æ–±–±–∏ –∏–≥—Ä—ã</h2>
        <div class="lobby">
            <h3>–ö–æ–¥ –∏–≥—Ä—ã:</h3>
            <div id="game-code-display">XXXX</div>
            <p>–ò–≥—Ä–æ–∫–∏ –≤ –ª–æ–±–±–∏: <span id="player-count">1</span>/6</p>
            <div id="lobby-player-list"></div>
            <button id="start-game-btn" disabled>–ù–∞—á–∞—Ç—å –∏–≥—Ä—É (–ù—É–∂–Ω–æ –æ—Ç 2 –¥–æ 6 –∏–≥—Ä–æ–∫–æ–≤)</button>
        </div>
    </div>
    
    <div id="game-container" class="game-container">
        <div class="tabs">
            <div class="tab active" data-tab="game-board">–ò–≥—Ä–∞</div>
            <div class="tab" data-tab="player-stats">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
            <div class="tab" data-tab="rules">–ü—Ä–∞–≤–∏–ª–∞</div>
        </div>
        
        <div id="game-board" class="tab-content active">
            <h2>–ì–æ–¥ <span id="game-year">1</span> | –°–µ–∑–æ–Ω: <span id="game-season">–í–µ—Å–Ω–∞</span></h2>
            
            <div class="event-area">
                <h3>–¢–µ–∫—É—â–µ–µ —Å–æ–±—ã—Ç–∏–µ</h3>
                <div id="current-event" class="event-display">
                    –û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π...
                </div>
            </div>
            
            <h3>–ò–≥—Ä–æ–∫–∏</h3>
            <div id="player-list" class="player-list"></div>
            
            <div class="action-area" id="action-buttons">
                <button id="harvest-btn">–°–æ–±—Ä–∞—Ç—å —É—Ä–æ–∂–∞–π (+5 –µ–¥—ã, -3 –∑–¥–æ—Ä–æ–≤—å—è)</button>
                <button id="hunt-btn">–û—Ö–æ—Ç–∏—Ç—å—Å—è (+3 –µ–¥—ã, -2 –∑–¥–æ—Ä–æ–≤—å—è)</button>
                <button id="pray-btn">–ú–æ–ª–∏—Ç—å—Å—è (+2 –±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏—è, -1 –∑–¥–æ—Ä–æ–≤—å—è)</button>
                <button id="rest-btn">–û—Ç–¥—ã—Ö–∞—Ç—å (+4 –∑–¥–æ—Ä–æ–≤—å—è)</button>
                <button id="trade-btn">–¢–æ—Ä–≥–æ–≤–∞—Ç—å</button>
                <button id="build-btn">–°—Ç—Ä–æ–∏—Ç—å</button>
                <button id="end-turn-btn">–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ö–æ–¥</button>
            </div>
            
            <div class="log-area" id="game-log">
                <p>–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å—Ç—Ä–∞–¥–∞—é—â–µ–µ —Å—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤—å–µ!</p>
            </div>
        </div>
        
        <div id="player-stats" class="tab-content">
            <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä–æ–∫–æ–≤</h2>
            <div id="stats-content">
                <table style="width: 100%; border-collapse: collapse; text-align: center;">
                    <thead>
                        <tr>
                            <th style="border: 1px solid #771c1c; padding: 8px;">–ò–≥—Ä–æ–∫</th>
                            <th style="border: 1px solid #771c1c; padding: 8px;">–ü–µ—Ä–µ–∂–∏–ª —Å–µ–∑–æ–Ω–æ–≤</th>
                            <th style="border: 1px solid #771c1c; padding: 8px;">–ü–æ—Å—Ç—Ä–æ–µ–Ω–æ –∑–¥–∞–Ω–∏–π</th>
                            <th style="border: 1px solid #771c1c; padding: 8px;">–†–∞–∑ —É–º–∏—Ä–∞–ª</th>
                            <th style="border: 1px solid #771c1c; padding: 8px;">–û—á–∫–∏ –≤—ã–∂–∏–≤–∞–Ω–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="stats-table-body">
                        <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä–æ–∫–æ–≤ -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div id="rules" class="tab-content">
            <h2>–ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã</h2>
            <div>
                <h3>–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∫–∏:</h3>
                <ol>
                    <li>–£ –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞ –µ—Å—Ç—å —Ä–µ—Å—É—Ä—Å—ã: –ó–¥–æ—Ä–æ–≤—å–µ, –ï–¥–∞, –ë–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏—è –∏ –î–µ–Ω—å–≥–∏.</li>
                    <li>–ö–∞–∂–¥—ã–π —Ö–æ–¥ (—Å–µ–∑–æ–Ω) –∏–≥—Ä–æ–∫ –¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–¥–Ω–æ –¥–µ–π—Å—Ç–≤–∏–µ.</li>
                    <li>–í –∫–æ–Ω—Ü–µ —Å–µ–∑–æ–Ω–∞ –≤—Å–µ –∏–≥—Ä–æ–∫–∏ —Ç–µ—Ä—è—é—Ç 2 –µ–¥–∏–Ω–∏—Ü—ã –µ–¥—ã (–∑–∏–º–æ–π 4).</li>
                    <li>–ï—Å–ª–∏ —É –∏–≥—Ä–æ–∫–∞ –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å –µ–¥–∞, –æ–Ω —Ç–µ—Ä—è–µ—Ç 5 –∑–¥–æ—Ä–æ–≤—å—è –∑–∞ —Å–µ–∑–æ–Ω.</li>
                    <li>–ï—Å–ª–∏ –∑–¥–æ—Ä–æ–≤—å–µ —É–ø–∞–ª–æ –¥–æ 0, –∏–≥—Ä–æ–∫ —É–º–∏—Ä–∞–µ—Ç –∏ –≤–æ–∑—Ä–æ–∂–¥–∞–µ—Ç—Å—è —Å–æ —Å—Ç–∞—Ä—Ç–æ–≤—ã–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏.</li>
                    <li>–ö–∞–∂–¥—ã–π —Å–µ–∑–æ–Ω –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–ª—É—á–∞–π–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤.</li>
                    <li>–ò–≥—Ä–∞ –¥–ª–∏—Ç—Å—è 20 –ª–µ—Ç (80 —Å–µ–∑–æ–Ω–æ–≤). –ü–æ–±–µ–∂–¥–∞–µ—Ç –∏–≥—Ä–æ–∫ —Å –Ω–∞–∏–±–æ–ª—å—à–∏–º–∏ –æ—á–∫–∞–º–∏ –≤—ã–∂–∏–≤–∞–Ω–∏—è.</li>
                </ol>
                
                <h3>–î–µ–π—Å—Ç–≤–∏—è:</h3>
                <ul>
                    <li><strong>–°–æ–±—Ä–∞—Ç—å —É—Ä–æ–∂–∞–π:</strong> +5 –µ–¥—ã, -3 –∑–¥–æ—Ä–æ–≤—å—è</li>
                    <li><strong>–û—Ö–æ—Ç–∏—Ç—å—Å—è:</strong> +3 –µ–¥—ã, -2 –∑–¥–æ—Ä–æ–≤—å—è</li>
                    <li><strong>–ú–æ–ª–∏—Ç—å—Å—è:</strong> +2 –±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏—è, -1 –∑–¥–æ—Ä–æ–≤—å—è</li>
                    <li><strong>–û—Ç–¥—ã—Ö–∞—Ç—å:</strong> +4 –∑–¥–æ—Ä–æ–≤—å—è</li>
                    <li><strong>–¢–æ—Ä–≥–æ–≤–∞—Ç—å:</strong> –û–±–º–µ–Ω–∏–≤–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã</li>
                    <li><strong>–°—Ç—Ä–æ–∏—Ç—å:</strong> –í–æ–∑–≤–æ–¥–∏—Ç—å –∑–¥–∞–Ω–∏—è, –¥–∞—é—â–∏–µ –±–æ–Ω—É—Å—ã</li>
                </ul>
                
                <h3>–ó–¥–∞–Ω–∏—è:</h3>
                <ul>
                    <li><strong>–•–∏–∂–∏–Ω–∞ (5 –º–æ–Ω–µ—Ç):</strong> +1 –∑–¥–æ—Ä–æ–≤—å–µ –∫–∞–∂–¥—ã–π —Å–µ–∑–æ–Ω</li>
                    <li><strong>–û–≥–æ—Ä–æ–¥ (7 –º–æ–Ω–µ—Ç):</strong> +1 –µ–¥–∞ –∫–∞–∂–¥—ã–π —Å–µ–∑–æ–Ω</li>
                    <li><strong>–ê–ª—Ç–∞—Ä—å (10 –º–æ–Ω–µ—Ç):</strong> +1 –±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏–µ –∫–∞–∂–¥—ã–π —Å–µ–∑–æ–Ω</li>
                    <li><strong>–õ–∞–≤–∫–∞ (15 –º–æ–Ω–µ—Ç):</strong> +1 –º–æ–Ω–µ—Ç–∞ –∫–∞–∂–¥—ã–π —Å–µ–∑–æ–Ω</li>
                </ul>
                
                <h3>–ë–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏—è:</h3>
                <p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏—è, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π —Å–æ–±—ã—Ç–∏–π.</p>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div id="trade-modal" style="display: none; position: fixed; z-index: 1; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4);">
        <div style="background-color: #f9f1e0; margin: 15% auto; padding: 20px; border: 1px solid #771c1c; width: 50%; border-radius: 5px;">
            <h3>–¢–æ—Ä–≥–æ–≤–ª—è</h3>
            <div style="display: flex; justify-content: space-around;">
                <div>
                    <h4>–ü—Ä–æ–¥–∞—Ç—å:</h4>
                    <button class="trade-btn" data-sell="food" data-buy="money">2 –ï–¥—ã ‚Üí 1 –ú–æ–Ω–µ—Ç–∞</button><br><br>
                    <button class="trade-btn" data-sell="blessing" data-buy="money">1 –ë–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏–µ ‚Üí 2 –ú–æ–Ω–µ—Ç—ã</button><br><br>
                    <button class="trade-btn" data-sell="health" data-buy="money">2 –ó–¥–æ—Ä–æ–≤—å—è ‚Üí 1 –ú–æ–Ω–µ—Ç–∞</button>
                </div>
                <div>
                    <h4>–ö—É–ø–∏—Ç—å:</h4>
                    <button class="trade-btn" data-sell="money" data-buy="food">1 –ú–æ–Ω–µ—Ç–∞ ‚Üí 1 –ï–¥–∞</button><br><br>
                    <button class="trade-btn" data-sell="money" data-buy="blessing">3 –ú–æ–Ω–µ—Ç—ã ‚Üí 1 –ë–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏–µ</button><br><br>
                    <button class="trade-btn" data-sell="money" data-buy="health">2 –ú–æ–Ω–µ—Ç—ã ‚Üí 1 –ó–¥–æ—Ä–æ–≤—å–µ</button>
                </div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button id="close-trade-modal">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>
    
    <div id="build-modal" style="display: none; position: fixed; z-index: 1; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4);">
        <div style="background-color: #f9f1e0; margin: 15% auto; padding: 20px; border: 1px solid #771c1c; width: 50%; border-radius: 5px;">
            <h3>–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ</h3>
            <div style="display: flex; flex-direction: column; gap: 10px;">
                <button class="build-btn" data-building="hut">–•–∏–∂–∏–Ω–∞ (5 –º–æ–Ω–µ—Ç): +1 –∑–¥–æ—Ä–æ–≤—å–µ –∫–∞–∂–¥—ã–π —Å–µ–∑–æ–Ω</button>
                <button class="build-btn" data-building="garden">–û–≥–æ—Ä–æ–¥ (7 –º–æ–Ω–µ—Ç): +1 –µ–¥–∞ –∫–∞–∂–¥—ã–π —Å–µ–∑–æ–Ω</button>
                <button class="build-btn" data-building="altar">–ê–ª—Ç–∞—Ä—å (10 –º–æ–Ω–µ—Ç): +1 –±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏–µ –∫–∞–∂–¥—ã–π —Å–µ–∑–æ–Ω</button>
                <button class="build-btn" data-building="shop">–õ–∞–≤–∫–∞ (15 –º–æ–Ω–µ—Ç): +1 –º–æ–Ω–µ—Ç–∞ –∫–∞–∂–¥—ã–π —Å–µ–∑–æ–Ω</button>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button id="close-build-modal">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        // –°–∏–º—É–ª—è—Ü–∏—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–∞ (–¥–ª—è MVP)
        let gameState = {
            gameCode: '',
            players: [],
            currentPlayerIndex: 0,
            year: 1,
            season: 0,
            seasons: ['–í–µ—Å–Ω–∞', '–õ–µ—Ç–æ', '–û—Å–µ–Ω—å', '–ó–∏–º–∞'],
            currentEvent: null,
            totalDeaths: 0,
            isGameStarted: false
        };
        
        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
        const events = [
            { name: "–ß—É–º–∞", description: "–≠–ø–∏–¥–µ–º–∏—è —á—É–º—ã! –í—Å–µ —Ç–µ—Ä—è—é—Ç 3 –∑–¥–æ—Ä–æ–≤—å—è, –µ—Å–ª–∏ –Ω–µ—Ç –±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏—è.", effect: player => {
                if (player.resources.blessing > 0) {
                    player.resources.blessing--;
                    return `${player.name} –∏–∑–±–µ–∂–∞–ª —á—É–º—ã, –ø–æ—Ç—Ä–∞—Ç–∏–≤ –±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏–µ!`;
                } else {
                    player.resources.health -= 3;
                    return `${player.name} –ø–æ—Ç–µ—Ä—è–ª 3 –∑–¥–æ—Ä–æ–≤—å—è –æ—Ç —á—É–º—ã!`;
                }
            }},
            { name: "–£—Ä–æ–∂–∞–π–Ω—ã–π –≥–æ–¥", description: "–û—Ç–ª–∏—á–Ω—ã–π —É—Ä–æ–∂–∞–π! –í—Å–µ –ø–æ–ª—É—á–∞—é—Ç +2 –µ–¥—ã.", effect: player => {
                player.resources.food += 2;
                return `${player.name} –ø–æ–ª—É—á–∏–ª 2 –µ–¥—ã –æ—Ç —Ö–æ—Ä–æ—à–µ–≥–æ —É—Ä–æ–∂–∞—è!`;
            }},
            { name: "–í–æ–π–Ω–∞", description: "–í–æ–π–Ω–∞! –í—Å–µ —Ç–µ—Ä—è—é—Ç 2 –º–æ–Ω–µ—Ç—ã, –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ -2 –∑–¥–æ—Ä–æ–≤—å—è.", effect: player => {
                if (player.resources.money >= 2) {
                    player.resources.money -= 2;
                    return `${player.name} –ø–æ—Ç–µ—Ä—è–ª 2 –º–æ–Ω–µ—Ç—ã –Ω–∞ –≤–æ–π–Ω—É!`;
                } else {
                    player.resources.health -= 2;
                    return `–£ ${player.name} –Ω–µ –±—ã–ª–æ –º–æ–Ω–µ—Ç, –ø–æ—Ç–µ—Ä—è–ª 2 –∑–¥–æ—Ä–æ–≤—å—è –Ω–∞ –≤–æ–π–Ω–µ!`;
                }
            }},
            { name: "–ë–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏–µ", description: "–ë–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏–µ —Å–≤—ã—à–µ! –í—Å–µ –ø–æ–ª—É—á–∞—é—Ç +1 –±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏–µ.", effect: player => {
                player.resources.blessing += 1;
                return `${player.name} –ø–æ–ª—É—á–∏–ª –±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏–µ —Å–≤—ã—à–µ!`;
            }},
            { name: "–ì–æ–ª–æ–¥", description: "–ì–æ–ª–æ–¥–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–∞! –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –µ–¥—ã —É–¥–≤–æ–µ–Ω–æ –≤ —ç—Ç–æ–º —Å–µ–∑–æ–Ω–µ!", effect: player => {
                // –≠—Ñ—Ñ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –≤ —Ñ—É–Ω–∫—Ü–∏–∏ endTurn
                return `${player.name} –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≥–æ—Ç–æ–≤ –∫ –ø–æ–≤—ã—à–µ–Ω–Ω–æ–º—É —Ä–∞—Å—Ö–æ–¥—É –µ–¥—ã!`;
            }},
            { name: "–ù–∞–ª–æ–≥–∏", description: "–ö–æ—Ä–æ–ª—å —Ç—Ä–µ–±—É–µ—Ç –Ω–∞–ª–æ–≥–∏! –í—Å–µ –ø–ª–∞—Ç—è—Ç 3 –º–æ–Ω–µ—Ç—ã –∏–ª–∏ —Ç–µ—Ä—è—é—Ç 3 –∑–¥–æ—Ä–æ–≤—å—è.", effect: player => {
                if (player.resources.money >= 3) {
                    player.resources.money -= 3;
                    return `${player.name} –∑–∞–ø–ª–∞—Ç–∏–ª 3 –º–æ–Ω–µ—Ç—ã –Ω–∞–ª–æ–≥–æ–≤.`;
                } else {
                    player.resources.health -= 3;
                    return `${player.name} –Ω–µ —Å–º–æ–≥ –∑–∞–ø–ª–∞—Ç–∏—Ç—å –Ω–∞–ª–æ–≥–∏ –∏ –ø–æ—Ç–µ—Ä—è–ª 3 –∑–¥–æ—Ä–æ–≤—å—è!`;
                }
            }},
            { name: "–ü—Ä–∞–∑–¥–Ω–∏–∫", description: "–ü—Ä–∞–∑–¥–Ω–∏–∫ —É—Ä–æ–∂–∞—è! –í—Å–µ –ø–æ–ª—É—á–∞—é—Ç +1 –∑–¥–æ—Ä–æ–≤—å—è –∏ +1 –µ–¥—ã.", effect: player => {
                player.resources.health += 1;
                player.resources.food += 1;
                return `${player.name} –ø–æ–ª—É—á–∏–ª 1 –∑–¥–æ—Ä–æ–≤—å—è –∏ 1 –µ–¥—É –Ω–∞ –ø—Ä–∞–∑–¥–Ω–∏–∫–µ!`;
            }},
            { name: "–í–æ—Ä—ã", description: "–í–æ—Ä—ã! –í—Å–µ —Ç–µ—Ä—è—é—Ç 2 –µ–¥—ã, –µ—Å–ª–∏ –Ω–µ—Ç –±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏—è.", effect: player => {
                if (player.resources.blessing > 0) {
                    player.resources.blessing--;
                    return `${player.name} –∑–∞—â–∏—Ç–∏–ª —Å–≤–æ—é –µ–¥—É –±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏–µ–º!`;
                } else if (player.resources.food >= 2) {
                    player.resources.food -= 2;
                    return `${player.name} –ø–æ—Ç–µ—Ä—è–ª 2 –µ–¥—ã –∏–∑-–∑–∞ –≤–æ—Ä–æ–≤!`;
                } else {
                    player.resources.food = 0;
                    return `${player.name} –ø–æ—Ç–µ—Ä—è–ª –≤—Å—é –µ–¥—É –∏–∑-–∑–∞ –≤–æ—Ä–æ–≤!`;
                }
            }},
            { name: "–¢–æ—Ä–≥–æ–≤—Ü—ã", description: "–ü—Ä–∏–µ—Ö–∞–ª–∏ —Ç–æ—Ä–≥–æ–≤—Ü—ã! –í—Å–µ –ø–æ–ª—É—á–∞—é—Ç +2 –º–æ–Ω–µ—Ç—ã.", effect: player => {
                player.resources.money += 2;
                return `${player.name} –ø–æ–ª—É—á–∏–ª 2 –º–æ–Ω–µ—Ç—ã –æ—Ç —Ç–æ—Ä–≥–æ–≤—Ü–µ–≤!`;
            }},
            { name: "–•–æ–ª–æ–¥–∞", description: "–ù–µ–æ–±—ã—á–Ω—ã–µ —Ö–æ–ª–æ–¥–∞! –í—Å–µ —Ç–µ—Ä—è—é—Ç 2 –∑–¥–æ—Ä–æ–≤—å—è, –µ—Å–ª–∏ –Ω–µ—Ç —Ö–∏–∂–∏–Ω—ã.", effect: player => {
                if (player.buildings.some(b => b.type === "hut")) {
                    return `${player.name} –ø–µ—Ä–µ–∂–∏–ª —Ö–æ–ª–æ–¥–∞ –≤ —Å–≤–æ–µ–π —Ö–∏–∂–∏–Ω–µ!`;
                } else {
                    player.resources.health -= 2;
                    return `${player.name} –ø–æ—Ç–µ—Ä—è–ª 2 –∑–¥–æ—Ä–æ–≤—å—è –æ—Ç —Ö–æ–ª–æ–¥–∞!`;
                }
            }}
        ];
        
        // –°—Ç–æ–∏–º–æ—Å—Ç—å –∑–¥–∞–Ω–∏–π
        const buildingCosts = {
            hut: 5,
            garden: 7,
            altar: 10,
            shop: 15
        };
        
        // –≠—Ñ—Ñ–µ–∫—Ç—ã –∑–¥–∞–Ω–∏–π
        const buildingEffects = {
            hut: player => { player.resources.health += 1; return `${player.name} –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª 1 –∑–¥–æ—Ä–æ–≤—å—è –æ—Ç —Ö–∏–∂–∏–Ω—ã!`; },
            garden: player => { player.resources.food += 1; return `${player.name} –ø–æ–ª—É—á–∏–ª 1 –µ–¥—É –æ—Ç –æ–≥–æ—Ä–æ–¥–∞!`; },
            altar: player => { player.resources.blessing += 1; return `${player.name} –ø–æ–ª—É—á–∏–ª 1 –±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏–µ –æ—Ç –∞–ª—Ç–∞—Ä—è!`; },
            shop: player => { player.resources.money += 1; return `${player.name} –ø–æ–ª—É—á–∏–ª 1 –º–æ–Ω–µ—Ç—É –æ—Ç –ª–∞–≤–∫–∏!`; }
        };
        
        // –ù–∞–∑–≤–∞–Ω–∏—è –∑–¥–∞–Ω–∏–π
        const buildingNames = {
            hut: "–•–∏–∂–∏–Ω–∞",
            garden: "–û–≥–æ—Ä–æ–¥",
            altar: "–ê–ª—Ç–∞—Ä—å",
            shop: "–õ–∞–≤–∫–∞"
        };
        
        // –°—Å—ã–ª–∫–∏ –Ω–∞ DOM-—ç–ª–µ–º–µ–Ω—Ç—ã
        const elements = {
            loginContainer: document.getElementById('login-container'),
            lobbyContainer: document.getElementById('lobby-container'),
            gameContainer: document.getElementById('game-container'),
            
            playerNameInput: document.getElementById('player-name'),
            createGameBtn: document.getElementById('create-game-btn'),
            gameCodeInput: document.getElementById('game-code-input'),
            joinGameBtn: document.getElementById('join-game-btn'),
            
            lobbyPlayerList: document.getElementById('lobby-player-list'),
            gameCodeDisplay: document.getElementById('game-code-display'),
            playerCount: document.getElementById('player-count'),
            startGameBtn: document.getElementById('start-game-btn'),
            
            playerList: document.getElementById('player-list'),
            gameYear: document.getElementById('game-year'),
            gameSeason: document.getElementById('game-season'),
            currentEvent: document.getElementById('current-event'),
            gameLog: document.getElementById('game-log'),
            
            harvestBtn: document.getElementById('harvest-btn'),
            huntBtn: document.getElementById('hunt-btn'),
            prayBtn: document.getElementById('pray-btn'),
            restBtn: document.getElementById('rest-btn'),
            tradeBtn: document.getElementById('trade-btn'),
            buildBtn: document.getElementById('build-btn'),
            endTurnBtn: document.getElementById('end-turn-btn'),
            
            tradeModal: document.getElementById('trade-modal'),
            buildModal: document.getElementById('build-modal'),
            closeTradeModal: document.getElementById('close-trade-modal'),
            closeBuildModal: document.getElementById('close-build-modal'),
            
            statsTableBody: document.getElementById('stats-table-body'),
            deathCounter: document.getElementById('death-counter')
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–∞–±–æ–≤
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö —Ç–∞–±–æ–≤
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                // –î–µ–ª–∞–µ–º —Ç–µ–∫—É—â–∏–π —Ç–∞–± –∞–∫—Ç–∏–≤–Ω—ã–º
                this.classList.add('active');
                
                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –∫–æ–Ω—Ç–µ–Ω—Ç—ã —Ç–∞–±–æ–≤
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ç–∞–±–∞
                document.getElementById(this.dataset.tab).classList.add('active');
            });
        });
        
        // –§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∫–æ–¥–∞ –∏–≥—Ä—ã
        function generateGameCode() {
            return Math.floor(1000 + Math.random() * 9000).toString();
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–≥—Ä—ã
        elements.createGameBtn.addEventListener('click', () => {
            const playerName = elements.playerNameInput.value.trim();
            if (!playerName) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏–≥—Ä–æ–∫–∞!');
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º –∫–æ–¥ –∏–≥—Ä—ã –∏ –¥–æ–±–∞–≤–ª—è–µ–º –∏–≥—Ä–æ–∫–∞
            gameState.gameCode = generateGameCode();
            gameState.players = [{
                id: 1,
                name: playerName,
                resources: { health: 10, food: 5, blessing: 1, money: 3 },
                buildings: [],
                stats: { seasonsAlive: 0, buildingsBuilt: 0, deaths: 0, survivalPoints: 0 },
                hasActed: false
            }];
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            elements.gameCodeDisplay.textContent = gameState.gameCode;
            elements.playerCount.textContent = gameState.players.length;
            updateLobbyPlayerList();
            
            // –°–∫—Ä—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –ª–æ–≥–∏–Ω–∞ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–±–±–∏
            elements.loginContainer.style.display = 'none';
            elements.lobbyContainer.style.display = 'block';
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ –∏–≥—Ä–µ
        elements.joinGameBtn.addEventListener('click', () => {
            const playerName = elements.playerNameInput.value.trim();
            const gameCode = elements.gameCodeInput.value.trim();
            
            if (!playerName) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏–≥—Ä–æ–∫–∞!');
                return;
            }
            
            if (gameCode !== gameState.gameCode) {
                alert('–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ –∏–≥—Ä—ã!');
                return;
            }
            
            if (gameState.players.length >= 6) {
                alert('–ò–≥—Ä–∞ —É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞!');
                return;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∏–≥—Ä–æ–∫–∞
            gameState.players.push({
                id: gameState.players.length + 1,
                name: playerName,
                resources: { health: 10, food: 5, blessing: 1, money: 3 },
                buildings: [],
                stats: { seasonsAlive: 0, buildingsBuilt: 0, deaths: 0, survivalPoints: 0 },
                hasActed: false
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            elements.playerCount.textContent = gameState.players.length;
            updateLobbyPlayerList();
            
            // –°–∫—Ä—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –ª–æ–≥–∏–Ω–∞ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–±–±–∏
            elements.loginContainer.style.display = 'none';
            elements.lobbyContainer.style.display = 'block';
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É
            checkStartGame();
        });
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∏–≥—Ä–æ–∫–æ–≤ –≤ –ª–æ–±–±–∏
        function updateLobbyPlayerList() {
            elements.lobbyPlayerList.innerHTML = '';
            gameState.players.forEach(player => {
                const playerDiv = document.createElement('div');
                playerDiv.textContent = player.name;
                playerDiv.style.padding = '5px';
                playerDiv.style.margin = '5px';
                playerDiv.style.backgroundColor = '#f9f1e0';
                playerDiv.style.border = '1px solid #771c1c';
                playerDiv.style.borderRadius = '3px';
                elements.lobbyPlayerList.appendChild(playerDiv);
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É
        function checkStartGame() {
            if (gameState.players.length >= 2) {
                elements.startGameBtn.disabled = false;
                elements.startGameBtn.textContent = `–ù–∞—á–∞—Ç—å –∏–≥—Ä—É (${gameState.players.length}/6 –∏–≥—Ä–æ–∫–æ–≤)`;
            } else {
                elements.startGameBtn.disabled = true;
                elements.startGameBtn.textContent = `–ù–∞—á–∞—Ç—å –∏–≥—Ä—É (–ù—É–∂–Ω–æ –æ—Ç 2 –¥–æ 6 –∏–≥—Ä–æ–∫–æ–≤)`;
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã
        elements.startGameBtn.addEventListener('click', () => {
            // –°–∫—Ä—ã–≤–∞–µ–º –ª–æ–±–±–∏ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–≥—Ä—É
            elements.lobbyContainer.style.display = 'none';
            elements.gameContainer.style.display = 'block';
            
            // –ù–∞—á–∏–Ω–∞–µ–º –∏–≥—Ä—É
            startGame();
        });
        
        // –§—É–Ω–∫—Ü–∏—è –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã
        function startGame() {
            gameState.isGameStarted = true;
            gameState.currentPlayerIndex = 0;
            gameState.year = 1;
            gameState.season = 0;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–µ—Ä–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ
            generateEvent();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateGameInfo();
            updatePlayerList();
            updateStats();
            
            // –õ–æ–≥–∏—Ä—É–µ–º –Ω–∞—á–∞–ª–æ –∏–≥—Ä—ã
            logMessage("–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å! " + gameState.players[gameState.currentPlayerIndex].name + " —Ö–æ–¥–∏—Ç –ø–µ—Ä–≤—ã–º.");
        }
        
        // –§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è
        function generateEvent() {
            const eventIndex = Math.floor(Math.random() * events.length);
            gameState.currentEvent = events[eventIndex];
            
            elements.currentEvent.innerHTML = `
                <strong>${gameState.currentEvent.name}</strong><br>
                ${gameState.currentEvent.description}
            `;
            
            logMessage(`–°–æ–±—ã—Ç–∏–µ: ${gameState.currentEvent.name} - ${gameState.currentEvent.description}`);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∏–≥—Ä–µ
        function updateGameInfo() {
            elements.gameYear.textContent = gameState.year;
            elements.gameSeason.textContent = gameState.seasons[gameState.season];
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∏–≥—Ä–æ–∫–æ–≤
        function updatePlayerList() {
            elements.playerList.innerHTML = '';
            
            gameState.players.forEach((player, index) => {
                const playerCard = document.createElement('div');
                playerCard.className = 'player-card';
                if (index === gameState.currentPlayerIndex) {
                    playerCard.classList.add('current-player');
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏–≥—Ä–æ–∫–∞
                if (!player.hasActed && index === gameState.currentPlayerIndex) {
                    playerCard.classList.add('active');
                }
                
                // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∏–≥—Ä–æ–∫–µ
                playerCard.innerHTML = `
                    <h3>${player.name} ${index === gameState.currentPlayerIndex ? '(—Ö–æ–¥–∏—Ç)' : ''}</h3>
                    <div class="resources-area">
                        <div class="resource">
                            <span>‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ:</span>
                            <span>${player.resources.health}</span>
                        </div>
                        <div class="resource">
                            <span>üçñ –ï–¥–∞:</span>
                            <span>${player.resources.food}</span>
                        </div>
                        <div class="resource">
                            <span>‚úùÔ∏è –ë–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏—è:</span>
                            <span>${player.resources.blessing}</span>
                        </div>
                        <div class="resource">
                            <span>üí∞ –î–µ–Ω—å–≥–∏:</span>
                            <span>${player.resources.money}</span>
                        </div>
                    </div>
                    
                    <div class="buildings-area">
                        <h4>–ó–¥–∞–Ω–∏—è:</h4>
                        ${player.buildings.length > 0 ? 
                            player.buildings.map(b => `
                                <div class="building">
                                    <span>${buildingNames[b.type]}</span>
                                </div>
                            `).join('') : 
                            '<p>–ù–µ—Ç –∑–¥–∞–Ω–∏–π</p>'
                        }
                    </div>
                `;
                
                elements.playerList.appendChild(playerCard);
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–Ω–æ–ø–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π
            updateActionButtons();
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∫–Ω–æ–ø–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π
        function updateActionButtons() {
            const isCurrentPlayerTurn = !gameState.players[gameState.currentPlayerIndex].hasActed;
            
            elements.harvestBtn.disabled = !isCurrentPlayerTurn;
            elements.huntBtn.disabled = !isCurrentPlayerTurn;
            elements.prayBtn.disabled = !isCurrentPlayerTurn;
            elements.restBtn.disabled = !isCurrentPlayerTurn;
            elements.tradeBtn.disabled = !isCurrentPlayerTurn;
            elements.buildBtn.disabled = !isCurrentPlayerTurn;
            elements.endTurnBtn.disabled = !isCurrentPlayerTurn;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            elements.statsTableBody.innerHTML = '';
            
            gameState.players.forEach(player => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td style="border: 1px solid #771c1c; padding: 8px;">${player.name}</td>
                    <td style="border: 1px solid #771c1c; padding: 8px;">${player.stats.seasonsAlive}</td>
                    <td style="border: 1px solid #771c1c; padding: 8px;">${player.stats.buildingsBuilt}</td>
                    <td style="border: 1px solid #771c1c; padding: 8px;">${player.stats.deaths}</td>
                    <td style="border: 1px solid #771c1c; padding: 8px;">${player.stats.survivalPoints}</td>
                `;
                elements.statsTableBody.appendChild(row);
            });
            
            elements.deathCounter.textContent = gameState.totalDeaths;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ª–æ–≥
        function logMessage(message) {
            const logEntry = document.createElement('p');
            logEntry.textContent = message;
            elements.gameLog.appendChild(logEntry);
            elements.gameLog.scrollTop = elements.gameLog.scrollHeight;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–º–µ—Ä—Ç–∏ –∏–≥—Ä–æ–∫–∞
        function checkPlayerDeath(player) {
            if (player.resources.health <= 0) {
                player.stats.deaths++;
                gameState.totalDeaths++;
                
                // –û–±–Ω—É–ª—è–µ–º —Ä–µ—Å—É—Ä—Å—ã –∏ –¥–∞–µ–º –±–∞–∑–æ–≤—ã–π –Ω–∞–±–æ—Ä
                player.resources = { health: 10, food: 5, blessing: 1, money: 3 };
                
                // –û–±–Ω—É–ª—è–µ–º –∑–¥–∞–Ω–∏—è (–∏–≥—Ä–æ–∫ —Ç–µ—Ä—è–µ—Ç –≤—Å–µ –∑–¥–∞–Ω–∏—è –ø—Ä–∏ —Å–º–µ—Ä—Ç–∏)
                player.buildings = [];
                
                logMessage(`‚ò†Ô∏è ${player.name} —É–º–µ—Ä –∏ –≤–æ–∑—Ä–æ–¥–∏–ª—Å—è —Å–æ —Å—Ç–∞—Ä—Ç–æ–≤—ã–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏!`);
                return true;
            }
            return false;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–Ω—Ü–∞ —Ö–æ–¥–∞ –∏–≥—Ä–æ–∫–∞
        function endPlayerTurn() {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            currentPlayer.hasActed = true;
            
            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∏–≥—Ä–æ–∫—É
            gameState.currentPlayerIndex = (gameState.currentPlayerIndex + 1) % gameState.players.length;
            
            // –ï—Å–ª–∏ –≤—Å–µ –∏–≥—Ä–æ–∫–∏ —Å–¥–µ–ª–∞–ª–∏ —Ö–æ–¥, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Å–µ–∑–æ–Ω—É
            if (gameState.currentPlayerIndex === 0) {
                endSeason();
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updatePlayerList();
            
            logMessage(`–•–æ–¥ –ø–µ—Ä–µ—à–µ–ª –∫ –∏–≥—Ä–æ–∫—É ${gameState.players[gameState.currentPlayerIndex].name}`);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–Ω—Ü–∞ —Å–µ–∑–æ–Ω–∞
        function endSeason() {
            logMessage(`–°–µ–∑–æ–Ω ${gameState.seasons[gameState.season]} –≥–æ–¥–∞ ${gameState.year} –∑–∞–≤–µ—Ä—à–µ–Ω!`);
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã –∑–¥–∞–Ω–∏–π –¥–ª—è –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤
            gameState.players.forEach(player => {
                player.buildings.forEach(building => {
                    const effect = buildingEffects[building.type](player);
                    logMessage(effect);
                });
            });
            
            // –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –µ–¥—ã –≤ –∫–æ–Ω—Ü–µ —Å–µ–∑–æ–Ω–∞
            const isWinter = gameState.season === 3; // –ó–∏–º–∞
            const isHungerEvent = gameState.currentEvent.name === "–ì–æ–ª–æ–¥";
            
            gameState.players.forEach(player => {
                // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –≤—ã–∂–∏–≤—à–∏—Ö —Å–µ–∑–æ–Ω–æ–≤
                player.stats.seasonsAlive++;
                
                // –ë–∞–∑–æ–≤–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –µ–¥—ã
                let foodConsumption = isWinter ? 4 : 2;
                
                // –ï—Å–ª–∏ —Å–æ–±—ã—Ç–∏–µ "–ì–æ–ª–æ–¥", —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ
                if (isHungerEvent) {
                    foodConsumption *= 2;
                }
                
                // –ü–æ—Ç—Ä–µ–±–ª—è–µ–º –µ–¥—É
                if (player.resources.food >= foodConsumption) {
                    player.resources.food -= foodConsumption;
                    logMessage(`${player.name} –ø–æ—Ç—Ä–µ–±–∏–ª ${foodConsumption} –µ–¥—ã.`);
                } else {
                    // –ï—Å–ª–∏ –µ–¥—ã –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, –∏–≥—Ä–æ–∫ —Ç–µ—Ä—è–µ—Ç –∑–¥–æ—Ä–æ–≤—å–µ
                    const missingFood = foodConsumption - player.resources.food;
                    player.resources.food = 0;
                    player.resources.health -= 5;
                    logMessage(`${player.name} –Ω–µ —Ö–≤–∞—Ç–∏–ª–æ ${missingFood} –µ–¥—ã! –ü–æ—Ç–µ—Ä—è–Ω–æ 5 –∑–¥–æ—Ä–æ–≤—å—è!`);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —É–º–µ—Ä –ª–∏ –∏–≥—Ä–æ–∫
                    checkPlayerDeath(player);
                }
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –¥–µ–π—Å—Ç–≤–∏—è
                player.hasActed = false;
                
                // –ù–∞—á–∏—Å–ª—è–µ–º –æ—á–∫–∏ –≤—ã–∂–∏–≤–∞–Ω–∏—è
                player.stats.survivalPoints += 1 + player.buildings.length;
            });
            
            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Å–µ–∑–æ–Ω—É
            gameState.season = (gameState.season + 1) % 4;
            
            // –ï—Å–ª–∏ –Ω–∞—Å—Ç—É–ø–∏–ª–∞ –≤–µ—Å–Ω–∞, —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –≥–æ–¥
            if (gameState.season === 0) {
                gameState.year++;
                logMessage(`–ù–∞—Å—Ç—É–ø–∏–ª –Ω–æ–≤—ã–π –≥–æ–¥ ${gameState.year}!`);
            }
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ
            generateEvent();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateGameInfo();
            updatePlayerList();
            updateStats();
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π
        elements.harvestBtn.addEventListener('click', () => {
            const player = gameState.players[gameState.currentPlayerIndex];
            player.resources.food += 5;
            player.resources.health -= 3;
            
            logMessage(`${player.name} —Å–æ–±—Ä–∞–ª —É—Ä–æ–∂–∞–π: +5 –µ–¥—ã, -3 –∑–¥–æ—Ä–æ–≤—å—è`);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —É–º–µ—Ä –ª–∏ –∏–≥—Ä–æ–∫
            if (checkPlayerDeath(player)) {
                updateStats();
            }
            
            endPlayerTurn();
        });
        
        elements.huntBtn.addEventListener('click', () => {
            const player = gameState.players[gameState.currentPlayerIndex];
            player.resources.food += 3;
            player.resources.health -= 2;
            
            logMessage(`${player.name} –ø–æ–æ—Ö–æ—Ç–∏–ª—Å—è: +3 –µ–¥—ã, -2 –∑–¥–æ—Ä–æ–≤—å—è`);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —É–º–µ—Ä –ª–∏ –∏–≥—Ä–æ–∫
            if (checkPlayerDeath(player)) {
                updateStats();
            }
            
            endPlayerTurn();
        });
        
        elements.prayBtn.addEventListener('click', () => {
            const player = gameState.players[gameState.currentPlayerIndex];
            player.resources.blessing += 2;
            player.resources.health -= 1;
            
            logMessage(`${player.name} –ø–æ–º–æ–ª–∏–ª—Å—è: +2 –±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏—è, -1 –∑–¥–æ—Ä–æ–≤—å—è`);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —É–º–µ—Ä –ª–∏ –∏–≥—Ä–æ–∫
            if (checkPlayerDeath(player)) {
                updateStats();
            }
            
            endPlayerTurn();
        });
        
        elements.restBtn.addEventListener('click', () => {
            const player = gameState.players[gameState.currentPlayerIndex];
            player.resources.health += 4;
            
            logMessage(`${player.name} –æ—Ç–¥–æ—Ö–Ω—É–ª: +4 –∑–¥–æ—Ä–æ–≤—å—è`);
            
            endPlayerTurn();
        });
        
        elements.tradeBtn.addEventListener('click', () => {
            elements.tradeModal.style.display = 'block';
        });
        
        elements.buildBtn.addEventListener('click', () => {
            elements.buildModal.style.display = 'block';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–Ω–æ–ø–æ–∫ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–µ–Ω–µ–≥
            const player = gameState.players[gameState.currentPlayerIndex];
            document.querySelectorAll('.build-btn').forEach(button => {
                const buildingType = button.dataset.building;
                button.disabled = player.resources.money < buildingCosts[buildingType];
            });
        });
        
        elements.endTurnBtn.addEventListener('click', () => {
            logMessage(`${gameState.players[gameState.currentPlayerIndex].name} –ø—Ä–æ–ø—É—Å—Ç–∏–ª —Ö–æ–¥`);
            endPlayerTurn();
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
        elements.closeTradeModal.addEventListener('click', () => {
            elements.tradeModal.style.display = 'none';
        });
        
        elements.closeBuildModal.addEventListener('click', () => {
            elements.buildModal.style.display = 'none';
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Ç–æ—Ä–≥–æ–≤–ª–∏
        document.querySelectorAll('.trade-btn').forEach(button => {
            button.addEventListener('click', () => {
                const player = gameState.players[gameState.currentPlayerIndex];
                const sellResource = button.dataset.sell;
                const buyResource = button.dataset.buy;
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ—Å—É—Ä—Å–æ–≤ –¥–ª—è –æ–±–º–µ–Ω–∞
                let sellAmount, buyAmount;
                
                if (sellResource === 'food' && buyResource === 'money') {
                    sellAmount = 2;
                    buyAmount = 1;
                } else if (sellResource === 'blessing' && buyResource === 'money') {
                    sellAmount = 1;
                    buyAmount = 2;
                } else if (sellResource === 'health' && buyResource === 'money') {
                    sellAmount = 2;
                    buyAmount = 1;
                } else if (sellResource === 'money' && buyResource === 'food') {
                    sellAmount = 1;
                    buyAmount = 1;
                } else if (sellResource === 'money' && buyResource === 'blessing') {
                    sellAmount = 3;
                    buyAmount = 1;
                } else if (sellResource === 'money' && buyResource === 'health') {
                    sellAmount = 2;
                    buyAmount = 1;
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ —Ä–µ—Å—É—Ä—Å–æ–≤
                if (player.resources[sellResource] < sellAmount) {
                    alert(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ${sellResource} –¥–ª—è –æ–±–º–µ–Ω–∞!`);
                    return;
                }
                
                // –û—Å—É—â–µ—Å—Ç–≤–ª—è–µ–º –æ–±–º–µ–Ω
                player.resources[sellResource] -= sellAmount;
                player.resources[buyResource] += buyAmount;
                
                logMessage(`${player.name} –æ–±–º–µ–Ω—è–ª ${sellAmount} ${getResourceName(sellResource)} –Ω–∞ ${buyAmount} ${getResourceName(buyResource)}`);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —É–º–µ—Ä –ª–∏ –∏–≥—Ä–æ–∫ (–µ—Å–ª–∏ –ø—Ä–æ–¥–∞–ª –∑–¥–æ—Ä–æ–≤—å–µ)
                if (sellResource === 'health' && checkPlayerDeath(player)) {
                    updateStats();
                }
                
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏ –∑–∞–≤–µ—Ä—à–∞–µ–º —Ö–æ–¥
                elements.tradeModal.style.display = 'none';
                endPlayerTurn();
            });
        });
        
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞
        function getResourceName(resourceKey) {
            const names = {
                'health': '–∑–¥–æ—Ä–æ–≤—å—è',
                'food': '–µ–¥—ã',
                'blessing': '–±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏—è',
                'money': '–º–æ–Ω–µ—Ç'
            };
            return names[resourceKey] || resourceKey;
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞
        document.querySelectorAll('.build-btn').forEach(button => {
            button.addEventListener('click', () => {
                const player = gameState.players[gameState.currentPlayerIndex];
                const buildingType = button.dataset.building;
                const cost = buildingCosts[buildingType];
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ –¥–µ–Ω–µ–≥
                if (player.resources.money < cost) {
                    alert(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥ –¥–ª—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞! –ù—É–∂–Ω–æ ${cost} –º–æ–Ω–µ—Ç.`);
                    return;
                }
                
                // –°–ø–∏—Å—ã–≤–∞–µ–º –¥–µ–Ω—å–≥–∏ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –∑–¥–∞–Ω–∏–µ
                player.resources.money -= cost;
                player.buildings.push({ type: buildingType });
                player.stats.buildingsBuilt++;
                
                logMessage(`${player.name} –ø–æ—Å—Ç—Ä–æ–∏–ª ${buildingNames[buildingType]} –∑–∞ ${cost} –º–æ–Ω–µ—Ç`);
                
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏ –∑–∞–≤–µ—Ä—à–∞–µ–º —Ö–æ–¥
                elements.buildModal.style.display = 'none';
                endPlayerTurn();
            });
        });
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–º—É–ª—è—Ü–∏–∏ –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (—Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
        /*
        function generateTestPlayers() {
            gameState.gameCode = "1234";
            gameState.players = [
                {
                    id: 1,
                    name: "–ò–≥—Ä–æ–∫ 1",
                    resources: { health: 10, food: 5, blessing: 1, money: 3 },
                    buildings: [],
                    stats: { seasonsAlive: 0, buildingsBuilt: 0, deaths: 0, survivalPoints: 0 },
                    hasActed: false
                },
                {
                    id: 2,
                    name: "–ò–≥—Ä–æ–∫ 2",
                    resources: { health: 10, food: 5, blessing: 1, money: 3 },
                    buildings: [],
                    stats: { seasonsAlive: 0, buildingsBuilt: 0, deaths: 0, survivalPoints: 0 },
                    hasActed: false
                }
            ];
            elements.loginContainer.style.display = 'none';
            elements.gameContainer.style.display = 'block';
            startGame();
        }
        //generateTestPlayers();
        */
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
        window.onclick = function(event) {
            if (event.target === elements.tradeModal) {
                elements.tradeModal.style.display = 'none';
            }
            if (event.target === elements.buildModal) {
                elements.buildModal.style.display = 'none';
            }
        };
    </script>
</body>
</html>
